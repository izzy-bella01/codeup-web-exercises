<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
        <!--   MapBox    -->
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />

        <title>Weather Map Project</title>
        <style>
            .card-style {
                height: 22rem;
                width: 18rem;
            }
            #map {
                 /* the width and height may be set to any size */
                 width: 100%;
                 height: 350px;
             }
        </style>
    </head>
    <body>
    <h1>Weather Map Project</h1>
    <div class="d-flex" id="forecast"></div>
    <div id="map"></div>


                                            <!--BOOTSTRAP-->
<!--    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

    <script src="js/jquery-2.2.4.js"></script>
    <script src="js/keys.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <script src="./js/mapbox-geocoder-utils.js"></script>
    <script>
        // WEATHER API
        $.get("https://api.openweathermap.org/data/2.5/onecall", {
            // ONE CALL GETS DATA FOR A 7 DAY FORECAST
            APPID: WEATHER_MAP_TOKEN,
            lat:    29.423017,
            lon:   -98.48527,
            units: "imperial"
        })
        .done(function(weather) {
            console.log(weather);
            // THIS LOOP RUNS THROUGH THE WEATHER DATA OBJECT TO GET SPECIFIC INFORMATION NEEDED
            for(var i = 0; i < 5; i++) {
                // NEEDED TO CONVERT UNIX DATE TO HUMAN READABLE DATE
                var unixMilli = ((weather.daily[i].dt)*1000);
                var dateObject = new Date(unixMilli);
                var date = dateObject.toLocaleDateString();
                // VARIABLE CREATED TO USE IN APPEND
                var tempMin = Math.round(weather.daily[i].temp.min);
                var tempMax = Math.round(weather.daily[i].temp.max);
                var description = weather.daily[i].weather[0].description;
                var humidity = Math.round(weather.daily[i].humidity);
                var wind = Math.round(weather.daily[i].wind_speed);
                var pressure = Math.round(weather.daily[i].pressure);
                // VARIABLES FOR GRABBING WEATHER ICON
                var iconCode = weather.daily[i].weather[0].icon;
                var iconUrl = "http://openweathermap.org/img/w/" + iconCode + ".png";
                // APPENDING WEATHER DATA VARIABLES TO HTML USING TEMPLATE LITERALS
                $("#forecast").append(
                    `<div class="card m-2 card-style">
                        <h6 class="card-header text-center">${date}</h6>
                        <div class="card-body">
                            <p class="text-center">${tempMin}&deg;F / ${tempMax}&deg;F</p>
                            <div class="text-center">
                                <img id="weatherIcon" src="${iconUrl}" alt="Weather icon">
                            </div>
                            <hr>
                            <p>Description: <strong>${description}</strong></p>
                            <p>Humidity: <strong>${humidity}%</strong></p>
                            <p>Wind: <strong>${wind} mph</strong></p>
                            <p>Pressure: <strong>${pressure} hPa</strong></p>
                        </div>
                    </div>
                `)
            }
        })

        // MAPBOX API
        mapboxgl.accessToken = MAPBOX_TOKEN;
        var map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/streets-v9', // style URL
            zoom: 10, // starting zoom
            center: [-98.4916, 29.4252] // starting position [lng, lat]
        });

        const marker = new mapboxgl.Marker()
            .setLngLat([-98.4916, 29.4252])
            .addTo(map);


    </script>
    </body>
</html>